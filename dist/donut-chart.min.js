"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _createSuper(n){var r=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(n);return _possibleConstructorReturn(this,r?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _wrapNativeSuper(t){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(e,t)})(t)}function _construct(t,e,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var DonutChart=function(){_inherits(n,_wrapNativeSuper(HTMLElement));var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this)).highlightClass="highlight",t}return _createClass(n,null,[{key:"tag",get:function(){return"donut-chart"}}]),_createClass(n,[{key:"connectedCallback",value:function(){var e=this,n=this.attachShadow({mode:"open"}),r=this.getAttributes(this);r.source?fetch(r.source).then(function(t){return t.json()}).then(function(t){r.data=t,e.withProcessedData(r),e.createShadowDom(n,r)}):(this.withProcessedData(r),this.createShadowDom(n,r))}},{key:"disconnectedCallback",value:function(){}},{key:"createShadowDom",value:function(r,t){var o=this,e='\n        <style type="text/css">\n            #donut-chart {\n                '.concat("right"===t.legendPositon?"display: flex;":"","\n            }\n\n            @media screen and (max-width: 600px) {\n                #donut-chart {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                }\n            }\n\n            .circle {\n                stroke-dasharray: ").concat(t.perimeter,";\n                stroke-dashoffset: ").concat(t.perimeter,";\n                transition: stroke-dashoffset .8s ease;\n            }\n\n            .circle.highlight {\n                stroke: ").concat(t.highlightColor,";\n            }\n\n            .legend {\n                margin-left: 15px;\n                padding-top: 20px;\n                user-select: none;\n                cursor: pointer;\n            }\n\n            .name-item {\n                display: inline-flex;\n                align-items: center;\n                margin-bottom: 5px;\n                white-space: nowrap;\n                padding: 0 3px;\n            }\n\n            .name-item.highlight {\n                background: ").concat(t.highlightColor,";\n            }\n\n            .square {\n                border: 1px solid;\n                width: 10px;\n                height: 10px;\n                margin-right: 10px;\n            }\n\n            .middle-text {\n                dominant-baseline: middle;\n                text-anchor: middle;\n                fill: ").concat(t.middleTextColor,";\n                font-size: ").concat(t.middleTextSize,";\n            }\n        </style>");r.innerHTML=e+this.getHtml(t);var i=r.querySelectorAll(".circle"),n=r.querySelectorAll(".name-item");setTimeout(function(){o.animate(i,t.perimeter)},100),n.forEach(function(t,n){t.addEventListener("click",function(t){var e=t.currentTarget.classList.contains(o.highlightClass);o.unHighlightAllChartItems(r.querySelectorAll(".".concat(o.highlightClass))),o.highlightChartItem(t.currentTarget,i[n],e)})}),this.setAttribute("connected",!0)}},{key:"unHighlightAllChartItems",value:function(t){var e=this;t.forEach(function(t){t.classList.remove(e.highlightClass)})}},{key:"highlightChartItem",value:function(t,e,n){e.classList.toggle(this.highlightClass,!n),t.classList.toggle(this.highlightClass,!n)}},{key:"animate",value:function(t,e){var n=this;t.forEach(function(t){t.style.strokeDashoffset="".concat(n.getFillAmount(parseFloat(t.getAttribute("data-fill")),e),"px")})}},{key:"sortItems",value:function(t){return t?t.sort(function(t,e){return e.percent-t.percent}):[]}},{key:"getAttributes",value:function(t){var e={};return e.data=JSON.parse(t.getAttribute("data")),e.source=t.getAttribute("source"),e.legendPositon=t.getAttribute("legend")||"bottom",e.radius=parseInt(t.getAttribute("radius"))||40,e.strokeWidth=parseInt(t.getAttribute("stroke-width"))||20,e.highlightColor=t.getAttribute("highlight")||"#a8d1ff",e.middleColor=t.getAttribute("middle-color")||"#eee",e.middleText=t.getAttribute("middle-text"),e.middleTextColor=t.getAttribute("middle-text-color")||"black",e.middleTextSize=t.getAttribute("middle-text-size")||"12px",e.size={width:parseInt(t.getAttribute("width"))||250,height:parseInt(t.getAttribute("height"))||250},e.perimeter=parseFloat(6.28*e.radius).toFixed(2),e}},{key:"processChartData",value:function(t){for(var e,n=[];t[0];)e=0,t.forEach(function(t){e+=parseFloat(t.percent)}),n.push({color:t[0].color,name:t[0].name,originPercent:t[0].percent,percent:e}),t.shift();return n}},{key:"withProcessedData",value:function(t){t.data=this.sortItems(t.data),t.data=this.processChartData(t.data)}},{key:"getFillAmount",value:function(t,e){return parseFloat(e-e*t/100).toFixed(2)}},{key:"getHtml",value:function(e){var n="",r=50,o=50;return'\n        <div id="donut-chart">\n            <svg width="'.concat(e.size.width,'" height="').concat(e.size.height,'" viewbox="0 0 100 100">\n                <circle cx="').concat(r,'" cy="').concat(o,'" r="').concat(e.radius,'" fill="').concat(e.middleColor,'" id="radius"/>\n                ').concat(e.middleText?'<text x="'.concat(r,'" y="').concat(o,'" class="middle-text">').concat(e.middleText,"</text>"):"",'\n                <circle cx="').concat(r,'" cy="').concat(o,'" r="').concat(e.radius,'" fill="transparent" stroke-width="').concat(e.strokeWidth,'" stroke="grey"/>\n                ').concat(e.data.map(function(t){return n+='<div class="name-item"><div class="square" style="background:'.concat(t.color,"; border-color: ").concat(t.color,'"></div>').concat(t.name,"&nbsp;&nbsp;").concat(t.originPercent," %</div><br/>"),'<circle cx="'.concat(r,'" cy="').concat(o,'" r="').concat(e.radius,'" fill="transparent" stroke-width="').concat(e.strokeWidth,'" stroke="').concat(t.color,'" data-fill="').concat(t.percent,'" class="circle"/>')}).join(""),'\n            </svg>\n            <div class="legend">').concat(n,"</div>\n        </div>\n        ")}}]),n}();window.customElements.define("donut-chart",DonutChart);
